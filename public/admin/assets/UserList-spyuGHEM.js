import{u as z,r as a,z as h,j as e,P as n,B as l,E}from"./index-sc-SFr2S.js";import{T as A,D as I}from"./DataTable-ByMG-nip.js";import{S as D}from"./Switch-DwCfhMNo.js";import{g as L,u as $}from"./user.service-BHe9dvcP.js";import{P as F}from"./pen-CcOmJIoD.js";import{P as M}from"./plus-D77MjF12.js";import"./useDebounce-DKa2rmUY.js";import"./triangle-alert-Bk_Dupw5.js";const V=()=>{const o=z(),[y,c]=a.useState([]),[N,x]=a.useState(!0),[g,_]=a.useState(""),[d,p]=a.useState(1),[m,S]=a.useState(10),[b,w]=a.useState(1),[P,C]=a.useState(0),[j,v]=a.useState(null),[R,k]=a.useState(null),f=a.useCallback(async()=>{x(!0),v(null);try{const t=await L({page:d,limit:m,search:g});c(Array.isArray(t.users)?t.users:[]),w(t.pagination?.totalPages||1),C(t.pagination?.total??t.pagination?.totalItems??0)}catch(t){console.error("Failed to fetch users",t);const s=t.message||"Failed to load users";v(s),h.error(s)}finally{x(!1)}},[d,m,g]);a.useEffect(()=>{f()},[f]);const T=async(t,s)=>{try{c(r=>r.map(i=>i.admin_id===t.admin_id?{...i,is_active:s}:i)),await $(t.admin_id,{is_active:s}),h.success(`User ${s?"activated":"deactivated"} successfully`)}catch(r){console.error("Toggle failed",r),h.error("Failed to update user status"),c(i=>i.map(u=>u.admin_id===t.admin_id?{...u,is_active:!s}:u))}},U=a.useMemo(()=>[{key:"full_name",header:"Name",sortable:!0},{key:"email",header:"Email",sortable:!0},{key:"role",header:"Role",sortable:!0,render:(t,s)=>s.role?.role_name||"-"},{key:"is_active",header:"Status",className:"text-center",render:(t,s)=>e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{permissions:"users.edit",children:e.jsx(D,{checked:s.is_active,onCheckedChange:r=>T(s,r)})}),e.jsx("span",{className:`text-xs ${s.is_active?"text-green-600":"text-slate-500"}`,children:s.is_active?"Active":"Inactive"})]})},{key:"admin_id",header:"Actions",className:"text-center",render:(t,s)=>e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{permissions:"users.view",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o(`/users/view/${s.admin_id}`),className:"text-gray-600 hover:text-gray-900",children:e.jsx(E,{className:"h-4 w-4"})})}),e.jsx(n,{permissions:"users.edit",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>o(`/users/edit/${s.admin_id}`),className:"text-blue-600 hover:text-blue-900",children:e.jsx(F,{className:"h-4 w-4"})})}),e.jsx(n,{permissions:"users.delete",children:e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>k(s),className:"text-red-600 hover:text-red-900",children:e.jsx(A,{className:"h-4 w-4"})})})]})}],[o]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"User Management"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Manage system users and their roles"})]}),e.jsx(n,{permissions:"users.create",children:e.jsx(l,{onClick:()=>o("/users/add"),leftIcon:e.jsx(M,{className:"h-4 w-4"}),children:"Add User"})})]}),j&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-md border border-red-200",children:j}),e.jsx(I,{columns:U,data:y,onSearch:_,pagination:{currentPage:d,totalPages:b,totalItems:P,onPageChange:p,pageSize:m,onPageSizeChange:t=>{S(t),p(1)},pageSizeOptions:[10,25,50,100]},isLoading:N,rowKey:"admin_id",headerClassName:"bg-slate-900 text-white",showRowNumbers:!0})]})};export{V as default};
