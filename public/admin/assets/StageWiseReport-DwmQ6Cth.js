import{b as U,y as I,r as i,a as m,z as l,j as e,C as o,B as b,U as O,F as v}from"./index-sc-SFr2S.js";import{P as T}from"./PageHeader-BwoUE2Oi.js";import{D as H}from"./download-DJF4dsJ7.js";import{F as z}from"./file-spreadsheet-CKb8VEmu.js";import{C as G}from"./circle-check-big-sBo8KNPK.js";import"./plus-D77MjF12.js";const K=()=>{const{postId:c}=U(),[u,y]=I(),[g,w]=i.useState(null),[S,_]=i.useState([]),[a,C]=i.useState(u.get("district_id")||""),[r,E]=i.useState(u.get("stage")||"ELIGIBLE"),[d,$]=i.useState([]),[x,p]=i.useState(!1),[L,D]=i.useState([]),f=[{value:"ELIGIBLE",label:"Eligible List",color:"blue"},{value:"PROVISIONAL_SELECTED",label:"Provisional Selected",color:"yellow"},{value:"SELECTED",label:"Selected List",color:"green"}];i.useEffect(()=>{k(),P()},[c]),i.useEffect(()=>{a&&r&&R()},[a,r]);const k=async()=>{try{const t=await m.get(`/posts/${c}`);t.data.success&&w(t.data.data)}catch{l.error("Failed to fetch post details")}},P=async()=>{try{const t=await m.get("/masters/districts");t.data.success&&_(t.data.data)}catch{l.error("Failed to fetch districts")}},R=async()=>{p(!0);try{const t=a?`district_id=${encodeURIComponent(a)}&`:"",s=await m.get(`/admin/review/posts/${c}/stage-report?${t}stage=${r}`);s.data.success&&($(s.data.data.stageHistory||[]),D(s.data.data.rows||[]))}catch(t){l.error(t.response?.data?.message||"Failed to fetch stage report")}finally{p(!1)}},F=t=>{C(t);const s={};t&&(s.district_id=t),r&&(s.stage=r),y(s)},A=t=>{E(t);const s={};a&&(s.district_id=a),t&&(s.stage=t),y(s)},j=async t=>{if(!a)return l.error("Please select a district first");p(!0);try{const s=await m.get(`/admin/review/posts/${c}/stage-report?district_id=${a}&stage=${r}&format=${t}`,{responseType:"blob"}),h=new Blob([s.data],{type:t==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a"),B=`post_${c}_${r.toLowerCase()}.${t==="pdf"?"pdf":"xlsx"}`;n.href=window.URL.createObjectURL(h),n.download=B,document.body.appendChild(n),n.click(),document.body.removeChild(n),l.success(`Downloading ${t.toUpperCase()} report`)}catch(s){l.error(s.response?.data?.message||`Failed to download ${t.toUpperCase()} report`)}finally{p(!1)}},N=t=>f.find(h=>h.value===t)?.color||"gray";return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"Final List Report",subtitle:g?`${g.post_name} (${g.post_code})`:"Loading post details..."}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"District"}),e.jsxs("select",{value:a,onChange:t=>F(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select District"}),e.jsx("option",{value:"ALL",children:"All Districts"}),S.map(t=>e.jsx("option",{value:t.district_id,children:t.district_name},t.district_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stage"}),e.jsx("div",{className:"flex gap-2",children:f.map(t=>e.jsx("button",{onClick:()=>A(t.value),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${r===t.value?`bg-${t.color}-600 text-white`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Download"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:()=>j("pdf"),variant:"secondary",className:"flex-1",disabled:x||!a,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"PDF"]}),e.jsxs(b,{onClick:()=>j("xlsx"),variant:"secondary",className:"flex-1",disabled:x||!a,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Excel"]})]})]})]})}),!x&&d.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 bg-${N(r)}-100 rounded-lg`,children:e.jsx(O,{className:`w-6 h-6 text-${N(r)}-600`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Applications"})]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.filter(t=>!t.exited_at).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Currently in Stage"})]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.filter(t=>t.exited_at).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Moved to Next Stage"})]})]})})]}),e.jsx(o,{children:e.jsx("div",{className:"overflow-x-auto",children:x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stage report..."})]}):d.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No applications found in this stage"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select a district and stage to view the report"})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Application No."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Applicant Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entered Stage"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Entered By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Exited Stage"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:L.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.application_no||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.applicant_name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.gender||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.district_name||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.post_code||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.stage_status||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.current_status||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.selected_at||"—"})]},t.application_no))})]})})})]})};export{K as default};
