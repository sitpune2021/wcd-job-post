import{u as T,r as a,R as D,j as e,P as h,B as g}from"./index-f2aTh8Q9.js";import{T as z,D as E}from"./DataTable-CZSwVV32.js";import{g as L,d as M}from"./role.service-YQ4oXYS4.js";import{P as A}from"./pen-GrH3TWDv.js";import{P as B}from"./plus-CEVaGo_4.js";import"./useDebounce-CD3y76_H.js";import"./triangle-alert-0CRYubsC.js";const H=()=>{const c=T(),[u,N]=a.useState([]),[R,x]=a.useState(!0),[o,d]=a.useState(1),[r,p]=a.useState(10),[f,v]=a.useState(1),[j,S]=a.useState(0),[l,C]=a.useState(""),P=async(s=o,t=r,k=l)=>{x(!0);try{const{roles:m,pagination:n}=await L({page:s,limit:t,search:k||void 0}),y=m.map(i=>({role_id:i.role_id,role_name:i.role_name,role_code:i.role_code,description:i.description||"",is_system_role:i.is_system_role}));console.log("API Response:",{page:s,limit:t,receivedPage:n.page,receivedTotal:n.total,receivedTotalPages:n.totalPages,rolesCount:y.length}),N(y),p(n.limit),v(n.totalPages),S(n.total)}catch(m){console.error("Failed to fetch roles",m)}finally{x(!1)}};D.useEffect(()=>{P(o,r,l)},[o,r,l]);const _=async s=>{if(confirm(`Are you sure you want to delete ${s.length} roles?`))try{await Promise.all(s.map(t=>M(t.role_id))),P(o,r,l)}catch(t){console.error("Delete failed",t)}},b=a.useCallback(s=>{s!==l&&(d(1),C(s))},[l]),w=a.useMemo(()=>[{key:"role_name",header:"Role Name",sortable:!0},{key:"role_code",header:"Code",sortable:!0},{key:"description",header:"Description"},{key:"role_id",header:"Actions",className:"text-center",render:(s,t)=>e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(h,{permissions:"roles.edit",children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>c(`/roles/edit/${t.role_id}`),className:"text-blue-600 hover:text-blue-900",children:e.jsx(A,{className:"h-4 w-4"})})}),e.jsx(h,{permissions:"roles.delete",children:!t.is_system_role&&e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>_([t]),className:"text-red-600 hover:text-red-900",children:e.jsx(z,{className:"h-4 w-4"})})})]})}],[c]);return console.log("Component state:",{page:o,pageSize:r,totalPages:f,total:j,rolesCount:u.length}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Role Management"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Manage roles and permissions"})]}),e.jsx(h,{permissions:"roles.create",children:e.jsx(g,{onClick:()=>c("/roles/add"),leftIcon:e.jsx(B,{className:"h-4 w-4"}),children:"Add Role"})})]}),e.jsx(E,{columns:w,data:u,isLoading:R,onSearch:b,onDelete:_,pagination:{currentPage:o,totalPages:f,pageSize:r,total:j,pageSizeOptions:[10,20,50],onPageChange:s=>{console.log("Page changed to:",s),d(s)},onPageSizeChange:s=>{console.log("Page size changed to:",s),p(s),d(1)}},rowKey:"role_id",headerClassName:"bg-slate-900 text-white",showRowNumbers:!0})]})};export{H as default};
