import{_ as I,Z as U,u as A,R as _,d as P,e as F,r as x,j as e,B as p,C as L,I as n,f as B,E as Z,g as G,o as J,s as c,l as N,h as O}from"./index-BRObMItW.js";import{g as $}from"./role.service-C40ayKSx.js";import{S as q}from"./Switch-CCe21rqg.js";import{A as z}from"./arrow-left-BFV0G2W_.js";function H(s){return I(U,s)}const v=J({full_name:c().min(2,"Name must be at least 2 characters"),username:c().min(3,"Username must be at least 3 characters"),email:c().email("Invalid email address"),mobile_no:c().optional().or(N("")).refine(s=>s===void 0||s===""?!0:/^\d{10}$/.test(s),"Mobile number must be exactly 10 digits"),role_id:H().min(1,"Please select a valid role"),is_active:O().optional()}),K=v.extend({password:c().min(6,"Password must be at least 6 characters")}),Q=v.extend({password:c().optional().or(N(""))}),M=({initialData:s,isViewMode:r=!1,onSubmit:h,isLoading:w,title:y})=>{const b=A(),[m,S]=_.useState([]),[i,E]=_.useState(!1),o=!!s,{register:d,handleSubmit:R,formState:{errors:a},reset:f,control:k,watch:j}=P({resolver:F(o?Q:K),defaultValues:{full_name:"",username:"",email:"",mobile_no:"",password:"",role_id:s?.role_id!=null?Number(s.role_id):s?.role?.role_id!=null?Number(s.role.role_id):void 0,is_active:!0,...s}});x.useEffect(()=>{(async()=>{const t=await $(),u=Array.isArray(t)?t:t.roles||[];S(u)})()},[]),x.useEffect(()=>{if(s){const l={...s,role_id:s.role_id!=null?Number(s.role_id):s.role?.role_id!=null?Number(s.role.role_id):void 0,password:""};l.role_id!==void 0&&l.role_id!==null&&(l.role_id=Number(l.role_id)),f(l)}},[s,f]);const g=j("role_id");x.useEffect(()=>{o&&console.debug("UserForm role debug",{initialRoleId:s?.role_id||s?.role?.role_id,currentRoleId:g,rolesLoaded:m.length})},[g,s,o,m.length]);const C=l=>{if(o&&!l.password){const{password:t,...u}=l;h(u)}else h(l)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 ml-[-10px]",children:[e.jsx(p,{onClick:()=>b("/users"),variant:"ghost",leftIcon:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xl font-bold text-slate-900",children:y})})]}),e.jsx(L,{className:"w-full shadow-lg",children:e.jsxs("form",{onSubmit:R(C),className:"space-y-8 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(n,{label:"Full Name",placeholder:"John Doe",error:a.full_name?.message,disabled:r,...d("full_name")})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n,{label:"Username",placeholder:"johndoe",error:a.username?.message,disabled:r,...d("username")})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n,{label:"Email Address",placeholder:"john@example.com",type:"email",error:a.email?.message,disabled:r,...d("email")})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n,{label:o?"Password (leave blank to keep)":"Password",placeholder:o?"********":"Enter password",type:i?"text":"password",endIcon:!r&&(i?e.jsx(B,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})),onEndIconClick:()=>!r&&E(!i),error:a.password?.message,disabled:r,...d("password")})}),e.jsx("div",{className:"col-span-1",children:e.jsx(n,{label:"Mobile Number",placeholder:"9876543210",error:a.mobile_no?.message,disabled:r,inputMode:"numeric",maxLength:10,onInput:l=>{l.target.value=l.target.value.replace(/\D/g,"").slice(0,10)},...d("mobile_no")})}),e.jsxs("div",{className:"col-span-1 space-y-1.5 pt-1",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700",children:"Role"}),e.jsxs("select",{...d("role_id",{valueAsNumber:!0}),value:j("role_id")||"",disabled:r,className:"flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:bg-slate-100",children:[e.jsx("option",{value:"",children:"Select Role"}),m.map(l=>e.jsx("option",{value:Number(l.role_id),children:l.role_name},l.role_id))]}),a.role_id&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:a.role_id.message})]}),e.jsx("div",{className:"col-span-1 pt-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700",children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{name:"is_active",control:k,render:({field:{value:l,onChange:t}})=>e.jsx(q,{checked:!!l,onCheckedChange:t,disabled:r})}),e.jsx("span",{className:"text-sm text-slate-600",children:"Active"})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-100",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>b("/users"),children:r?"Go Back":"Cancel"}),!r&&e.jsx(p,{type:"submit",isLoading:w,children:"Save User"})]})]})})]})};export{M as U};
