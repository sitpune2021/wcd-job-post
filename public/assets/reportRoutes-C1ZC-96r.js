import{a as j,r as a,z as c,j as e,B as f,u as je,t as we,E as Ne,y as be,C as ee,F as ve,v as _e,w as I,N as Se}from"./index-BRObMItW.js";import{D as B,T as Ce}from"./DataTable-D6LM067x.js";import{P as T}from"./PageHeader-DZPtRzAy.js";import{D as C}from"./download-BP3zuujb.js";import{D as Le}from"./DocumentViewer-McUr_BQF.js";import{u as ke,M as te}from"./useFloatingTooltip-C5vdvB-0.js";import{j as Ee}from"./master.service-J7lkP8G3.js";import{U as se}from"./upload-b9J88q6q.js";import{F as Fe}from"./file-spreadsheet-CbxwHtFk.js";import"./useDebounce-XAFs3ZYN.js";import"./triangle-alert-BV9EplDZ.js";import"./plus-1-n6Dkk-.js";const F=o=>o.data.data||o.data,Re=async(o={})=>{const n=await j.get("/admin/reports/post-wise",{params:o});return F(n)},Pe=async(o={})=>{const n=await j.get("/admin/reports/post-selected",{params:o});return F(n)},ae=async(o,n={})=>await j.get("/admin/reports/post-wise/export",{params:{...n,format:o},responseType:"blob"}),W=async(o,n={})=>await j.get("/admin/reports/post-selected/export",{params:{...n,format:o},responseType:"blob"}),De=async o=>{const n=await j.get(`/admin/reports/post-selected/${o}/allotment-upload`);return F(n)},Ae=async(o,n)=>{const p=new FormData;p.append("file",n);const g=await j.post(`/admin/reports/post-selected/${o}/allotment-upload`,p,{headers:{"Content-Type":"multipart/form-data"}});return F(g)},Ie=async o=>{const n=await j.delete(`/admin/reports/post-selected/${o}/allotment-upload`);return F(n)},Ue=async(o={})=>{const n=await j.get("/admin/reports/district-wise",{params:o});return F(n)},oe=async(o,n={})=>await j.get("/admin/reports/district-wise/export",{params:{...n,format:o},responseType:"blob"}),Me=async(o={})=>{const n=await j.get("/admin/reports/component-wise",{params:o});return F(n)},le=async(o,n={})=>await j.get("/admin/reports/component-wise/export",{params:{...n,format:o},responseType:"blob"}),$e=async(o,n)=>{const p=await j.post(`/admin/reports/post-selected/${o}/schedule-email`,{scheduled_date:n});return F(p)},Te=async o=>{const n=await j.get(`/admin/reports/post-selected/${o}/email-status`);return F(n)},k=(o,n)=>{const p=o?.data;if(!p)throw new Error("No file data received");const g=o.headers?.["content-disposition"]||o.headers?.get?.("content-disposition");let w=n;if(g){const i=/filename="?([^";]+)"?/i.exec(g);i&&i[1]&&(w=i[1])}const x=window.URL.createObjectURL(p),u=document.createElement("a");u.href=x,u.download=w,document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(x)},Oe=()=>{const[o,n]=a.useState([]),[p,g]=a.useState(!0),[w,x]=a.useState(""),[u,i]=a.useState(!1),_=a.useCallback(async()=>{g(!0);try{const s=await Re(),h=s?.rows||s||[];n(Array.isArray(h)?h:[])}catch(s){console.error("Failed to load post wise report",s),c.error(s.message||"Failed to load report")}finally{g(!1)}},[]);a.useEffect(()=>{_()},[_]);const N=a.useMemo(()=>[{key:"post_code",header:"Post Code",sortable:!0},{key:"post_name",header:"Post Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:s=>s??0},{key:"selected_count",header:"Selected",className:"text-center",render:s=>s??0}],[]),d=a.useMemo(()=>{const s=(w||"").trim().toLowerCase();return s?o.filter(h=>{const L=String(h.post_code||"").toLowerCase(),b=String(h.post_name||"").toLowerCase();return L.includes(s)||b.includes(s)}):o},[o,w]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"Post Wise Report",description:"Post code/name with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await ae("xlsx");k(s,"post_wise_report.xlsx")}catch(s){c.error(s.message||"Failed to download Excel")}finally{i(!1)}},children:"Excel"}),e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await ae("pdf");k(s,"post_wise_report.pdf")}catch(s){c.error(s.message||"Failed to download PDF")}finally{i(!1)}},children:"PDF"})]})}),e.jsx(B,{columns:N,data:d,onSearch:x,isLoading:p,rowKey:"post_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},ze=()=>{je();const[o,n]=a.useState([]),[p,g]=a.useState(!0),[w,x]=a.useState(""),[u,i]=a.useState(!1),[_,N]=a.useState(!1),[d,s]=a.useState(null),[h,L]=a.useState([]),[b,Q]=a.useState(""),D=a.useRef(null),[U,A]=a.useState(!1),[y,l]=a.useState(null),[m,R]=a.useState(null),[M,v]=a.useState(!1),[re,H]=a.useState(!1),[O,K]=a.useState(""),[ne,G]=a.useState(!1),[E,X]=a.useState(null),[ie,Z]=a.useState(!1),{showTooltip:ce,scheduleHideTooltip:de,renderTooltip:me}=ke();a.useCallback(t=>{if(!t)return null;const r=String(t).replace(/^\/+/,"");return`${we}/${r}`},[]),a.useEffect(()=>{(async()=>{try{const r=await Ee({is_active:!0}),S=Array.isArray(r)?r:r.components||[];L(Array.isArray(S)?S:[])}catch(r){console.error("Failed to load components",r),c.error(r.message||"Failed to load components"),L([])}})()},[]);const J=a.useCallback(async()=>{if(!b){n([]),g(!1);return}g(!0);try{const t=await Pe({component_id:b}),r=t?.rows||t||[];n(Array.isArray(r)?r:[])}catch(t){console.error("Failed to load post selected report",t),c.error(t.message||"Failed to load report")}finally{g(!1)}},[b]);a.useEffect(()=>{N(!1),s(null),J()},[J]);const z=a.useCallback(t=>{const r=t?.component_name;return r?String(r):"-"},[]),pe=a.useMemo(()=>[{key:"post_code",header:"Post Code",sortable:!0},{key:"post_name",header:"Post Name",sortable:!0},{key:"selected_candidates",header:"Selected Candidates",render:(t,r)=>{const S=Array.isArray(r.selected_candidates)?r.selected_candidates:[],P=S.length,q=P>0;return e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsxs(e.Fragment,{children:[e.jsxs(f,{variant:"ghost",size:"sm",className:"px-2 text-blue-700 hover:text-blue-800",onMouseEnter:$=>{const fe=e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-700 mb-2",children:["Selected Candidates (",P,"):"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:S.map((ge,ye)=>e.jsxs("div",{className:"text-sm text-slate-600",children:["• ",ge]},ye))})]});ce($.currentTarget,fe,{width:256,estimatedHeight:Math.min(32+S.length*24,200)})},onMouseLeave:de,onClick:()=>{s(r),N(!0)},children:["View (",P,")"]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["(",P," candidate",P!==1?"s":"",")"]})]}):e.jsx("span",{className:"text-slate-400",children:"-"}),e.jsx(f,{variant:"outline",size:"sm",leftIcon:e.jsx(se,{className:"h-4 w-4"}),onClick:async()=>{if(r?.post_id){l(r),R(null),A(!0);try{v(!0);const $=await De(r.post_id);R($||null)}catch($){c.error($.message||"Failed to load upload info")}finally{v(!1)}}},children:"Upload"})]})}}],[]),Y=a.useMemo(()=>{const t=Array.isArray(d?.selected_candidates)?d.selected_candidates:[];return d?t.length===0?[{component:z(d),post_name:d.post_name,post_code:d.post_code,candidate_name:""}]:t.map(r=>({component:z(d),post_name:d.post_name,post_code:d.post_code,candidate_name:r})):[]},[d,z]),xe=a.useMemo(()=>{const t=(w||"").trim().toLowerCase();return t?o.filter(r=>{const S=String(r.post_code||"").toLowerCase(),P=String(r.post_name||"").toLowerCase(),q=Array.isArray(r.selected_candidates)?r.selected_candidates.join(", ").toLowerCase():"";return S.includes(t)||P.includes(t)||q.includes(t)}):o},[o,w]),ue=async()=>{try{i(!0);const t=await W("xlsx",{component_id:b});k(t,"allotment_report.xlsx")}catch(t){c.error(t.message||"Failed to download Excel")}finally{i(!1)}},V=a.useCallback(async t=>{if(t)try{Z(!0);const r=await Te(t);X(r)}catch(r){console.error("Failed to load email status:",r)}finally{Z(!1)}},[]),he=async()=>{if(!O){c.error("Please select a date and time");return}if(!y?.post_id){c.error("Invalid post");return}try{G(!0);const t=await $e(y.post_id,O);c.success(t.message||`Email scheduled for ${t.new_recipients} recipient(s)`),await V(y.post_id),K("")}catch(t){c.error(t.message||"Failed to schedule email")}finally{G(!1)}};return a.useEffect(()=>{U&&y?.post_id?V(y.post_id):(X(null),K(""))},[U,y?.post_id,V]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"Allotment Report",description:"Selected candidates full names by post",extraActions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"secondary",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:ue,children:"Download Excel"}),e.jsx(f,{variant:"secondary",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const t=await W("pdf",{component_id:b});k(t,"allotment_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{i(!1)}},disabled:!b,children:"Download PDF"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Component ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:b,onChange:t=>{Q(t.target.value),x("")},className:"w-full rounded-md border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Select Component"}),h.map(t=>e.jsx("option",{value:t.component_id,children:t.component_name},t.component_id))]})]}),e.jsx("div",{}),e.jsx("div",{})]})}),b?e.jsx(B,{columns:pe,data:xe,onSearch:x,isLoading:p,rowKey:"post_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"}):e.jsx("div",{className:"text-center py-10 bg-slate-50 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-slate-500",children:"Please select a component to view the allotment report"})}),e.jsx(te,{isOpen:_,onClose:()=>{N(!1),s(null)},title:"Selected Candidates",size:"generalLargeModal",footer:e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"outline",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{if(d?.post_id)try{i(!0);const t=await W("xlsx",{post_id:d.post_id,component_id:d.component_id});k(t,"allotment_report.xlsx")}catch(t){c.error(t.message||"Failed to download Excel")}finally{i(!1)}},children:"Excel"}),e.jsx(f,{variant:"outline",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{if(d?.post_id)try{i(!0);const t=await W("pdf",{post_id:d.post_id,component_id:d.component_id});k(t,"allotment_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{i(!1)}},children:"PDF"}),e.jsx(f,{variant:"ghost",onClick:()=>{N(!1),s(null)},children:"Close"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Component"}),e.jsx("div",{className:"text-sm font-medium text-slate-900",children:z(d)})]})}),e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-900 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Component"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Post Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Post Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Candidate Name"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 bg-white",children:[Y.map((t,r)=>e.jsxs("tr",{className:r%2===0?"bg-white":"bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 whitespace-nowrap",children:t.component||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:t.post_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 whitespace-nowrap",children:t.post_code||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:t.candidate_name||"-"})]},`${t.post_code||"row"}-${r}`)),Y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-10 text-center text-sm text-slate-500",children:"No data"})})]})]})})]})}),e.jsx(te,{isOpen:U,onClose:()=>{A(!1),l(null),R(null),H(!1),v(!1)},title:"Allotment File",size:"customAllotmentModal",footer:e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"outline",isLoading:M,leftIcon:e.jsx(se,{className:"h-4 w-4"}),onClick:()=>{D.current&&(D.current.value="",D.current.click())},children:"Upload"}),m?.file_path&&e.jsx(f,{variant:"outline",leftIcon:e.jsx(Ne,{className:"h-4 w-4"}),onClick:()=>H(!0),children:"Preview"}),m?.file_path&&e.jsx(f,{variant:"outline",isLoading:M,className:"text-red-600 hover:text-red-700",leftIcon:e.jsx(Ce,{className:"h-4 w-4"}),onClick:async()=>{if(y?.post_id)try{v(!0),await Ie(y.post_id),R(null),c.success("File removed")}catch(t){c.error(t.message||"Failed to delete file")}finally{v(!1)}},children:"Remove"}),e.jsx(f,{variant:"ghost",onClick:()=>{A(!1),l(null),R(null),H(!1)},children:"Close"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:D,type:"file",accept:"application/pdf,image/jpeg,image/jpg,image/png",className:"hidden",onChange:async t=>{const r=t.target.files?.[0];if(!(!r||!y?.post_id))try{v(!0);const S=await Ae(y.post_id,r);R(S||null),c.success("File uploaded")}catch(S){c.error(S.message||"Upload failed")}finally{v(!1)}}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Post"}),e.jsx("div",{className:"text-sm font-medium text-slate-900",children:y?.post_name||"-"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:y?.post_code||"-"})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Current File"}),M?e.jsx("div",{className:"text-sm text-slate-600",children:"Loading..."}):m?.file_path?e.jsx("div",{className:"text-sm font-medium text-slate-900 break-all",children:m.original_name||m.file_name||m.file_path}):e.jsx("div",{className:"text-sm text-slate-600",children:"No file uploaded"})]})]}),E?.candidates&&E.candidates.length>0&&e.jsxs("div",{className:"rounded-lg border bg-white p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-700 mb-3",children:["Candidates (",E.candidates.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Sent At"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:E.candidates.map((t,r)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-600",children:r+1}),e.jsx("td",{className:"px-3 py-2 text-slate-900",children:t.full_name}),e.jsx("td",{className:"px-3 py-2 text-slate-600",children:t.email}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${t.email_status==="SENT"?"bg-green-100 text-green-800":t.email_status==="PENDING"?"bg-amber-100 text-amber-800":t.email_status==="FAILED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-600"}`,children:t.email_status==="NOT_SCHEDULED"?"Not Sent":t.email_status})}),e.jsx("td",{className:"px-3 py-2 text-slate-600",children:t.sent_at?new Date(t.sent_at).toLocaleString("en-IN",{hour12:!0,timeZone:"Asia/Kolkata",dateStyle:"short",timeStyle:"short"}):"-"})]},t.applicant_id))})]})})]}),m?.file_path&&y?.selected_candidates&&y.selected_candidates.length>0&&e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Email Distribution"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-800 mb-1",children:"Schedule Date & Time"}),e.jsx("input",{type:"datetime-local",value:O,onChange:t=>K(t.target.value),min:new Date().toISOString().slice(0,16),className:"w-full rounded border border-blue-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Allotment PDF will be emailed to all selected candidates at the scheduled time"})]}),e.jsx(f,{variant:"primary",size:"sm",onClick:he,isLoading:ne,disabled:!O,className:"w-full",children:"Schedule Email to Selected Candidates"}),ie?e.jsx("div",{className:"text-xs text-blue-700",children:"Loading email status..."}):E?.summary&&e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-blue-900",children:"Overall Status"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-green-600 font-semibold",children:E.summary.totalSent||0}),e.jsx("div",{className:"text-slate-600",children:"Sent"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-amber-600 font-semibold",children:E.summary.totalPending||0}),e.jsx("div",{className:"text-slate-600",children:"Pending"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-red-600 font-semibold",children:E.summary.totalFailed||0}),e.jsx("div",{className:"text-slate-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 font-semibold",children:E.summary.totalNotScheduled||0}),e.jsx("div",{className:"text-slate-600",children:"Not Sent"})]})]})]})]})]}),re&&m?.file_path&&e.jsx("div",{className:"rounded-lg border bg-slate-50 p-3",children:e.jsx(Le,{src:m.file_path,fileName:m.original_name||m.file_name||"Allotment File",variant:"card"})})]})}),me()]})},We=[{value:"ELIGIBLE",label:"Eligible List",color:"blue"},{value:"PROVISIONAL_SELECTED",label:"Provisional List",color:"blue"},{value:"SELECTED",label:"Final List",color:"blue"}],Be=()=>{const[o]=be(),[n,p]=a.useState([]),[g,w]=a.useState([]),[x,u]=a.useState(o.get("post_id")||""),[i,_]=a.useState(o.get("district_id")||""),[N,d]=a.useState("ELIGIBLE"),[s,h]=a.useState([]),[L,b]=a.useState(!1);a.useEffect(()=>{Q(),D()},[]),a.useEffect(()=>{x&&i?U():h([])},[x,i,N]);const Q=async()=>{try{const l=await j.get("/admin/review/posts");l.data.success&&p(Array.isArray(l.data.data)?l.data.data:[])}catch{c.error("Failed to load posts")}},D=async()=>{try{const l=await j.get("/masters/districts");l.data.success&&w(l.data.data||[])}catch{c.error("Failed to load districts")}},U=async()=>{b(!0);try{const l=new URLSearchParams;i&&l.append("district_id",i),l.append("stage",N);const m=await j.get(`/admin/review/posts/${x}/stage-report?${l.toString()}`);m.data.success&&h(m.data.data?.rows||[])}catch(l){c.error(l.response?.data?.message||"Failed to fetch report")}finally{b(!1)}},A=async l=>{if(!x||!i)return c.error("Select post and district first");b(!0);try{const m=new URLSearchParams({district_id:i,stage:N,format:l}),R=await j.get(`/admin/review/posts/${x}/stage-report?${m.toString()}`,{responseType:"blob"}),M=new Blob([R.data],{type:l==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=document.createElement("a");v.href=window.URL.createObjectURL(M),v.download=`post_${x}_${N.toLowerCase()}.${l==="pdf"?"pdf":"xlsx"}`,document.body.appendChild(v),v.click(),document.body.removeChild(v),c.success(`Downloading ${l.toUpperCase()} report`)}catch(m){c.error(m.response?.data?.message||`Failed to download ${l.toUpperCase()} report`)}finally{b(!1)}},y=a.useMemo(()=>[{key:"sr_no",header:"Sr No."},{key:"application_no",header:"Application No."},{key:"applicant_name",header:"Applicant Name"},{key:"gender",header:"Gender"},{key:"district_name",header:"District"},{key:"post_code",header:"Post Code"},{key:"stage_status",header:"Stage"},{key:"entered_at",header:"Entered At"},{key:"entered_by",header:"Entered By"},{key:"current_status",header:"Current Status"}],[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"Final Lists (Post-wise)",subtitle:"Download Eligible / Provisional / Final lists with PDF or Excel export"}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Post"}),e.jsxs("select",{value:x,onChange:l=>u(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Post"}),n.map(l=>e.jsxs("option",{value:l.post_id,children:[l.post_name," (",l.post_code,")"]},l.post_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"District"}),e.jsxs("select",{value:i,onChange:l=>_(l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select District"}),e.jsx("option",{value:"ALL",children:"All Districts"}),g.map(l=>e.jsx("option",{value:l.district_id,children:l.district_name},l.district_id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stage"}),e.jsx("div",{className:"flex gap-2",children:We.map(l=>e.jsx("button",{onClick:()=>d(l.value),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${N===l.value?`bg-${l.color}-600 text-white`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(f,{onClick:()=>A("pdf"),variant:"secondary",disabled:L||!x||!i,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"PDF"]}),e.jsxs(f,{onClick:()=>A("xlsx"),variant:"secondary",disabled:L||!x||!i,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Excel"]})]})]}),e.jsx(ee,{children:e.jsx("div",{className:"overflow-x-auto",children:L?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading report..."})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No records found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select a post, district, and stage to view the list"})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"bg-slate-900 text-white",children:e.jsx("tr",{children:y.map(l=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider",children:l.header},l.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:s.map(l=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",children:y.map(m=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-700",children:l[m.key]??"—"},m.key))},`${l.application_no}-${l.stage_status}`))})]})})})]})},Qe=()=>{const[o,n]=a.useState([]),[p,g]=a.useState(!0),[w,x]=a.useState(""),[u,i]=a.useState(!1),_=a.useCallback(async()=>{g(!0);try{const s=await Ue(),h=s?.rows||s||[];n(Array.isArray(h)?h:[])}catch(s){console.error("Failed to load district wise report",s),c.error(s.message||"Failed to load report")}finally{g(!1)}},[]);a.useEffect(()=>{_()},[_]);const N=a.useMemo(()=>[{key:"district_name",header:"District Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:s=>s??0},{key:"selected_count",header:"Selected",className:"text-center",render:s=>s??0}],[]),d=a.useMemo(()=>{const s=(w||"").trim().toLowerCase();return s?o.filter(h=>String(h.district_name||"").toLowerCase().includes(s)):o},[o,w]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"District Wise Report",description:"District list with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await oe("xlsx");k(s,"district_wise_report.xlsx")}catch(s){c.error(s.message||"Failed to download XLSX")}finally{i(!1)}},children:"Excel"}),e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await oe("pdf");k(s,"district_wise_report.pdf")}catch(s){c.error(s.message||"Failed to download PDF")}finally{i(!1)}},children:"PDF"})]})}),e.jsx(B,{columns:N,data:d,onSearch:x,isLoading:p,rowKey:"district_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},He=()=>{const[o,n]=a.useState([]),[p,g]=a.useState(!0),[w,x]=a.useState(""),[u,i]=a.useState(!1),_=a.useCallback(async()=>{g(!0);try{const s=await Me(),h=s?.rows||s||[];n(Array.isArray(h)?h:[])}catch(s){console.error("Failed to load component wise report",s),c.error(s.message||"Failed to load report")}finally{g(!1)}},[]);a.useEffect(()=>{_()},[_]);const N=a.useMemo(()=>[{key:"component_name",header:"Component Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:s=>s??0},{key:"selected_count",header:"Selected",className:"text-center",render:s=>s??0}],[]),d=a.useMemo(()=>{const s=(w||"").trim().toLowerCase();return s?o.filter(h=>String(h.component_name||"").toLowerCase().includes(s)):o},[o,w]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{title:"OSC Wise Report",description:"List of OSC / Components with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await le("xlsx");k(s,"component_wise_report.xlsx")}catch(s){c.error(s.message||"Failed to download XLSX")}finally{i(!1)}},children:"Excel"}),e.jsx(f,{variant:"outline",size:"sm",isLoading:u,leftIcon:e.jsx(C,{className:"h-4 w-4"}),onClick:async()=>{try{i(!0);const s=await le("pdf");k(s,"component_wise_report.pdf")}catch(s){c.error(s.message||"Failed to download PDF")}finally{i(!1)}},children:"PDF"})]})}),e.jsx(B,{columns:N,data:d,onSearch:x,isLoading:p,rowKey:"component_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},ot=()=>e.jsxs(_e,{children:[e.jsx(I,{path:"/",element:e.jsx(Se,{to:"post-selected",replace:!0})}),e.jsx(I,{path:"post-selected",element:e.jsx(ze,{})}),e.jsx(I,{path:"final-list",element:e.jsx(Be,{})}),e.jsx(I,{path:"post-wise",element:e.jsx(Oe,{})}),e.jsx(I,{path:"district-wise",element:e.jsx(Qe,{})}),e.jsx(I,{path:"component-wise",element:e.jsx(He,{})})]});export{ot as default};
