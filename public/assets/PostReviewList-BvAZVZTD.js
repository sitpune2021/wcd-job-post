import{u as P,r as n,j as e,U as g,q as D,C as b,z as E}from"./index-BRObMItW.js";import{i as R}from"./admin.service-B9TIfHn5.js";import{u as k,S as F,C as I}from"./useDebounce-XAFs3ZYN.js";import{F as L}from"./funnel-BnL8ad68.js";const q=()=>{const f=P(),[r,N]=n.useState([]),[v,x]=n.useState(!0),[p,_]=n.useState(""),[c,w]=n.useState(""),[o,y]=n.useState(""),[d,S]=n.useState([]),[m,C]=n.useState([]),h=k(p,150),O=async(s={},i=!1)=>{x(!0);try{const a=await R(s),l=Array.isArray(a)?a:[];if(N(l),i){const u=new Map(d.map(t=>[t.id,t])),j=new Map(m.map(t=>[t.id,t]));l.forEach(t=>{t.component&&u.set(t.component.component_id,{id:t.component.component_id,name:t.component.component_name,name_mr:t.component.component_name_mr}),t.district&&j.set(t.district.district_id,{id:t.district.district_id,name:t.district.district_name,name_mr:t.district.district_name_mr})}),S(Array.from(u.values())),C(Array.from(j.values()))}}catch{E.error("Failed to load posts")}finally{x(!1)}};n.useEffect(()=>{O({search:h||void 0,component_id:c||void 0,district_id:o||void 0},c===""&&o===""&&d.length===0&&m.length===0)},[h,c,o]);const A=r.reduce((s,i)=>{const a=i.component?.component_name||"Other";return s[a]||(s[a]=[]),s[a].push(i),s},{});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Application Review"}),e.jsx("p",{className:"text-sm text-slate-500 mt-1",children:"Select a post to review eligible applications by merit"})]}),e.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-slate-100 text-slate-700",children:[e.jsx(g,{className:"h-3 w-3"})," ",r.length," posts"]}),v&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-blue-50 text-blue-700",children:[e.jsx(D,{className:"h-3 w-3 animate-spin"})," Loading"]})]})]}),e.jsxs(b,{className:"shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b flex items-center gap-2 text-slate-600 text-sm",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Search & Filter"})]}),e.jsxs("div",{className:"p-4 grid grid-cols-1 lg:grid-cols-12 gap-4",children:[e.jsxs("div",{className:"lg:col-span-6",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase mb-1 block font-extrabold",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"h-4 w-4 text-slate-400 absolute left-3 top-3"}),e.jsx("input",{type:"text",value:p,onChange:s=>_(s.target.value),placeholder:"Post name, code, OSC, district",className:"w-full pl-10 pr-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase mb-1 block font-extrabold",children:"Component (OSC)"}),e.jsxs("select",{className:"w-full border rounded-md px-3 py-2 text-sm",value:c,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"",children:"All Components"}),d.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.name_mr?` / ${s.name_mr}`:""]},s.id))]})]}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase mb-1 block font-extrabold",children:"District"}),e.jsxs("select",{className:"w-full border rounded-md px-3 py-2 text-sm",value:o,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"All Districts"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.name_mr?` / ${s.name_mr}`:""]},s.id))]})]})]})]}),Object.entries(A).map(([s,i])=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-700 mb-3",children:s}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(a=>{const l=a.application_counts||{};return e.jsx(b,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>f(`/review/posts/${a.post_id}`),children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:a.post_name}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:a.post_code})]}),e.jsx(I,{className:"h-5 w-5 text-slate-400"})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 text-center",children:[e.jsxs("div",{className:"bg-green-50 rounded p-2",children:[e.jsx("p",{className:"text-lg font-bold text-green-700",children:l.eligible_count||0}),e.jsx("p",{className:"text-xs font-medium text-green-700",children:"Eligible"})]}),e.jsxs("div",{className:"bg-rose-50 rounded p-2",children:[e.jsx("p",{className:"text-lg font-bold text-rose-700",children:l.rejected_count||0}),e.jsx("p",{className:"text-xs font-medium text-rose-700",children:"Rejected"})]}),e.jsxs("div",{className:"bg-amber-50 rounded p-2",children:[e.jsx("p",{className:"text-lg font-bold text-amber-700",children:l.on_hold_count||0}),e.jsx("p",{className:"text-xs font-medium text-amber-700",children:"On Hold"})]}),e.jsxs("div",{className:"bg-blue-50 rounded p-2",children:[e.jsx("p",{className:"text-lg font-bold text-blue-700",children:l.provisional_selected_count||0}),e.jsx("p",{className:"text-xs font-medium text-blue-700",children:"Provisional Selected"})]}),e.jsxs("div",{className:"bg-emerald-50 rounded p-2",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-700",children:l.selected_count||0}),e.jsx("p",{className:"text-xs font-medium text-emerald-700",children:"Selected"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t flex justify-between text-xs text-slate-500",children:e.jsxs("span",{className:"font-bold text-slate-700",children:["Total: ",e.jsx("span",{className:"font-bold text-slate-700",children:l.total_count||0})]})})]})},a.post_id)})})]},s)),r.length===0&&e.jsxs("div",{className:"text-center py-10 bg-slate-50 border border-dashed rounded-lg",children:[e.jsx(g,{className:"h-10 w-10 text-slate-300 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-500",children:"No active posts found"})]})]})};export{q as default};
