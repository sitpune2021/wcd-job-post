import{a as w,r as a,z as c,j as e,B as g,u as je,t as be,E as Ne,y as ve,C as ee,F as _e,v as Se,w as D,N as Ce}from"./index-f2aTh8Q9.js";import{D as T,T as Le}from"./DataTable-CZSwVV32.js";import{P as M}from"./PageHeader-C1BYbgZ6.js";import{D as S}from"./download-BV06V_bB.js";import{D as ke}from"./DocumentViewer-DQz3PaPC.js";import{u as Fe,M as te}from"./useFloatingTooltip-Cby1-Gn7.js";import{j as Ee}from"./master.service-Dpyd0E1I.js";import{U as se}from"./upload-DbsggVh3.js";import{F as Re}from"./file-spreadsheet-QueUJcMN.js";import"./useDebounce-CD3y76_H.js";import"./triangle-alert-0CRYubsC.js";import"./plus-CEVaGo_4.js";const F=o=>o.data.data||o.data,Pe=async(o={})=>{const l=await w.get("/admin/reports/post-wise",{params:o});return F(l)},De=async(o={})=>{const l=await w.get("/admin/reports/post-selected",{params:o});return F(l)},ae=async(o,l={})=>await w.get("/admin/reports/post-wise/export",{params:{...l,format:o},responseType:"blob"}),H=async(o,l={})=>await w.get("/admin/reports/post-selected/export",{params:{...l,format:o},responseType:"blob"}),Ae=async o=>{const l=await w.get(`/admin/reports/post-selected/${o}/allotment-upload`);return F(l)},Ie=async(o,l)=>{const p=new FormData;p.append("file",l);const h=await w.post(`/admin/reports/post-selected/${o}/allotment-upload`,p,{headers:{"Content-Type":"multipart/form-data"}});return F(h)},Me=async o=>{const l=await w.delete(`/admin/reports/post-selected/${o}/allotment-upload`);return F(l)},Ue=async(o={})=>{const l=await w.get("/admin/reports/district-wise",{params:o});return F(l)},oe=async(o,l={})=>await w.get("/admin/reports/district-wise/export",{params:{...l,format:o},responseType:"blob"}),Oe=async(o={})=>{const l=await w.get("/admin/reports/component-wise",{params:o});return F(l)},re=async(o,l={})=>await w.get("/admin/reports/component-wise/export",{params:{...l,format:o},responseType:"blob"}),$e=async(o={})=>{const l=await w.get("/admin/reports/hub-wise",{params:o});return F(l)},le=async(o,l={})=>await w.get("/admin/reports/hub-wise/export",{params:{...l,format:o},responseType:"blob"}),Te=async(o,l)=>{const p=await w.post(`/admin/reports/post-selected/${o}/schedule-email`,{scheduled_date:l});return F(p)},ze=async o=>{const l=await w.get(`/admin/reports/post-selected/${o}/email-status`);return F(l)},L=(o,l)=>{const p=o?.data;if(!p)throw new Error("No file data received");const h=o.headers?.["content-disposition"]||o.headers?.get?.("content-disposition");let y=l;if(h){const n=/filename="?([^";]+)"?/i.exec(h);n&&n[1]&&(y=n[1])}const u=window.URL.createObjectURL(p),x=document.createElement("a");x.href=u,x.download=y,document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(u)},We=()=>{const[o,l]=a.useState([]),[p,h]=a.useState(!0),[y,u]=a.useState(""),[x,n]=a.useState(!1),N=a.useCallback(async()=>{h(!0);try{const t=await Pe(),m=t?.rows||t||[];l(Array.isArray(m)?m:[])}catch(t){console.error("Failed to load post wise report",t),c.error(t.message||"Failed to load report")}finally{h(!1)}},[]);a.useEffect(()=>{N()},[N]);const j=a.useMemo(()=>[{key:"post_code",header:"Post Code",sortable:!0},{key:"post_name",header:"Post Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:t=>t??0},{key:"selected_count",header:"Selected",className:"text-center",render:t=>t??0}],[]),d=a.useMemo(()=>{const t=(y||"").trim().toLowerCase();return t?o.filter(m=>{const k=String(m.post_code||"").toLowerCase(),v=String(m.post_name||"").toLowerCase();return k.includes(t)||v.includes(t)}):o},[o,y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"Post Wise Report",description:"Post code/name with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await ae("xlsx");L(t,"post_wise_report.xlsx")}catch(t){c.error(t.message||"Failed to download Excel")}finally{n(!1)}},children:"Excel"}),e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await ae("pdf");L(t,"post_wise_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{n(!1)}},children:"PDF"})]})}),e.jsx(T,{columns:j,data:d,onSearch:u,isLoading:p,rowKey:"post_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},He=()=>{je();const[o,l]=a.useState([]),[p,h]=a.useState(!0),[y,u]=a.useState(""),[x,n]=a.useState(!1),[N,j]=a.useState(!1),[d,t]=a.useState(null),[m,k]=a.useState([]),[v,B]=a.useState(""),A=a.useRef(null),[U,I]=a.useState(!1),[b,r]=a.useState(null),[f,R]=a.useState(null),[O,_]=a.useState(!1),[ne,Q]=a.useState(!1),[z,K]=a.useState(""),[ie,V]=a.useState(!1),[E,G]=a.useState(null),[ce,Z]=a.useState(!1),{showTooltip:de,scheduleHideTooltip:me,renderTooltip:pe}=Fe();a.useCallback(s=>{if(!s)return null;const i=String(s).replace(/^\/+/,"");return`${be}/${i}`},[]),a.useEffect(()=>{(async()=>{try{const i=await Ee({is_active:!0}),C=Array.isArray(i)?i:i.components||[];k(Array.isArray(C)?C:[])}catch(i){console.error("Failed to load components",i),c.error(i.message||"Failed to load components"),k([])}})()},[]);const J=a.useCallback(async()=>{if(!v){l([]),h(!1);return}h(!0);try{const s=await De({component_id:v}),i=s?.rows||s||[];l(Array.isArray(i)?i:[])}catch(s){console.error("Failed to load post selected report",s),c.error(s.message||"Failed to load report")}finally{h(!1)}},[v]);a.useEffect(()=>{j(!1),t(null),J()},[J]);const W=a.useCallback(s=>{const i=s?.component_name;return i?String(i):"-"},[]),xe=a.useMemo(()=>[{key:"post_code",header:"Post Code",sortable:!0},{key:"post_name",header:"Post Name",sortable:!0},{key:"selected_candidates",header:"Selected Candidates",render:(s,i)=>{const C=Array.isArray(i.selected_candidates)?i.selected_candidates:[],P=C.length,q=P>0;return e.jsxs("div",{className:"flex items-center gap-2",children:[q?e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:"ghost",size:"sm",className:"px-2 text-blue-700 hover:text-blue-800",onMouseEnter:$=>{const ge=e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-700 mb-2",children:["Selected Candidates (",P,"):"]}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:C.map((ye,we)=>e.jsxs("div",{className:"text-sm text-slate-600",children:["• ",ye]},we))})]});de($.currentTarget,ge,{width:256,estimatedHeight:Math.min(32+C.length*24,200)})},onMouseLeave:me,onClick:()=>{t(i),j(!0)},children:["View (",P,")"]}),e.jsxs("span",{className:"text-xs text-slate-500",children:["(",P," candidate",P!==1?"s":"",")"]})]}):e.jsx("span",{className:"text-slate-400",children:"-"}),e.jsx(g,{variant:"outline",size:"sm",leftIcon:e.jsx(se,{className:"h-4 w-4"}),onClick:async()=>{if(i?.post_id){r(i),R(null),I(!0);try{_(!0);const $=await Ae(i.post_id);R($||null)}catch($){c.error($.message||"Failed to load upload info")}finally{_(!1)}}},children:"Upload"})]})}}],[]),Y=a.useMemo(()=>{const s=Array.isArray(d?.selected_candidates)?d.selected_candidates:[];return d?s.length===0?[{component:W(d),post_name:d.post_name,post_code:d.post_code,candidate_name:""}]:s.map(i=>({component:W(d),post_name:d.post_name,post_code:d.post_code,candidate_name:i})):[]},[d,W]),ue=a.useMemo(()=>{const s=(y||"").trim().toLowerCase();return s?o.filter(i=>{const C=String(i.post_code||"").toLowerCase(),P=String(i.post_name||"").toLowerCase(),q=Array.isArray(i.selected_candidates)?i.selected_candidates.join(", ").toLowerCase():"";return C.includes(s)||P.includes(s)||q.includes(s)}):o},[o,y]),he=async()=>{try{n(!0);const s=await H("xlsx",{component_id:v});L(s,"allotment_report.xlsx")}catch(s){c.error(s.message||"Failed to download Excel")}finally{n(!1)}},X=a.useCallback(async s=>{if(s)try{Z(!0);const i=await ze(s);G(i)}catch(i){console.error("Failed to load email status:",i)}finally{Z(!1)}},[]),fe=async()=>{if(!z){c.error("Please select a date and time");return}if(!b?.post_id){c.error("Invalid post");return}try{V(!0);const s=await Te(b.post_id,z);c.success(s.message||`Email scheduled for ${s.new_recipients} recipient(s)`),await X(b.post_id),K("")}catch(s){c.error(s.message||"Failed to schedule email")}finally{V(!1)}};return a.useEffect(()=>{U&&b?.post_id?X(b.post_id):(G(null),K(""))},[U,b?.post_id,X]),e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"Allotment Report",description:"Selected candidates full names by post",extraActions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"secondary",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:he,children:"Download Excel"}),e.jsx(g,{variant:"secondary",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const s=await H("pdf",{component_id:v});L(s,"allotment_report.pdf")}catch(s){c.error(s.message||"Failed to download PDF")}finally{n(!1)}},disabled:!v,children:"Download PDF"})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["OSC (One Stop Center) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:v,onChange:s=>{B(s.target.value),u("")},className:"w-full rounded-md border px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Select OSC"}),m.map(s=>e.jsx("option",{value:s.component_id,children:s.component_name},s.component_id))]})]}),e.jsx("div",{}),e.jsx("div",{})]})}),v?e.jsx(T,{columns:xe,data:ue,onSearch:u,isLoading:p,rowKey:"post_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"}):e.jsx("div",{className:"text-center py-10 bg-slate-50 border border-dashed rounded-lg",children:e.jsx("p",{className:"text-slate-500",children:"Please select an OSC to view the allotment report"})}),e.jsx(te,{isOpen:N,onClose:()=>{j(!1),t(null)},title:"Selected Candidates",size:"generalLargeModal",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{if(d?.post_id)try{n(!0);const s=await H("xlsx",{post_id:d.post_id,component_id:d.component_id});L(s,"allotment_report.xlsx")}catch(s){c.error(s.message||"Failed to download Excel")}finally{n(!1)}},children:"Excel"}),e.jsx(g,{variant:"outline",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{if(d?.post_id)try{n(!0);const s=await H("pdf",{post_id:d.post_id,component_id:d.component_id});L(s,"allotment_report.pdf")}catch(s){c.error(s.message||"Failed to download PDF")}finally{n(!1)}},children:"PDF"}),e.jsx(g,{variant:"ghost",onClick:()=>{j(!1),t(null)},children:"Close"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"OSC"}),e.jsx("div",{className:"text-sm font-medium text-slate-900",children:W(d)})]})}),e.jsx("div",{className:"overflow-x-auto rounded-lg border",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-900 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"OSC"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Post Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Post Code"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Candidate Name"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 bg-white",children:[Y.map((s,i)=>e.jsxs("tr",{className:i%2===0?"bg-white":"bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 whitespace-nowrap",children:s.component||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:s.post_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700 whitespace-nowrap",children:s.post_code||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:s.candidate_name||"-"})]},`${s.post_code||"row"}-${i}`)),Y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-10 text-center text-sm text-slate-500",children:"No data"})})]})]})})]})}),e.jsx(te,{isOpen:U,onClose:()=>{I(!1),r(null),R(null),Q(!1),_(!1)},title:"Allotment File",size:"customAllotmentModal",footer:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",isLoading:O,leftIcon:e.jsx(se,{className:"h-4 w-4"}),onClick:()=>{A.current&&(A.current.value="",A.current.click())},children:"Upload"}),f?.file_path&&e.jsx(g,{variant:"outline",leftIcon:e.jsx(Ne,{className:"h-4 w-4"}),onClick:()=>Q(!0),children:"Preview"}),f?.file_path&&e.jsx(g,{variant:"outline",isLoading:O,className:"text-red-600 hover:text-red-700",leftIcon:e.jsx(Le,{className:"h-4 w-4"}),onClick:async()=>{if(b?.post_id)try{_(!0),await Me(b.post_id),R(null),c.success("File removed")}catch(s){c.error(s.message||"Failed to delete file")}finally{_(!1)}},children:"Remove"}),e.jsx(g,{variant:"ghost",onClick:()=>{I(!1),r(null),R(null),Q(!1)},children:"Close"})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:A,type:"file",accept:"application/pdf,image/jpeg,image/jpg,image/png",className:"hidden",onChange:async s=>{const i=s.target.files?.[0];if(!(!i||!b?.post_id))try{_(!0);const C=await Ie(b.post_id,i);R(C||null),c.success("File uploaded")}catch(C){c.error(C.message||"Upload failed")}finally{_(!1)}}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Post"}),e.jsx("div",{className:"text-sm font-medium text-slate-900",children:b?.post_name||"-"}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:b?.post_code||"-"})]}),e.jsxs("div",{className:"rounded-lg border bg-white p-3",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Current File"}),O?e.jsx("div",{className:"text-sm text-slate-600",children:"Loading..."}):f?.file_path?e.jsx("div",{className:"text-sm font-medium text-slate-900 break-all",children:f.original_name||f.file_name||f.file_path}):e.jsx("div",{className:"text-sm text-slate-600",children:"No file uploaded"})]})]}),E?.candidates&&E.candidates.length>0&&e.jsxs("div",{className:"rounded-lg border bg-white p-4",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-700 mb-3",children:["Candidates (",E.candidates.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"#"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-slate-600",children:"Sent At"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:E.candidates.map((s,i)=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-3 py-2 text-slate-600",children:i+1}),e.jsx("td",{className:"px-3 py-2 text-slate-900",children:s.full_name}),e.jsx("td",{className:"px-3 py-2 text-slate-600",children:s.email}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${s.email_status==="SENT"?"bg-green-100 text-green-800":s.email_status==="PENDING"?"bg-amber-100 text-amber-800":s.email_status==="FAILED"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-600"}`,children:s.email_status==="NOT_SCHEDULED"?"Not Sent":s.email_status})}),e.jsx("td",{className:"px-3 py-2 text-slate-600",children:s.sent_at?new Date(s.sent_at).toLocaleString("en-IN",{hour12:!0,timeZone:"Asia/Kolkata",dateStyle:"short",timeStyle:"short"}):"-"})]},s.applicant_id))})]})})]}),f?.file_path&&b?.selected_candidates&&b.selected_candidates.length>0&&e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Email Distribution"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-800 mb-1",children:"Schedule Date & Time"}),e.jsx("input",{type:"datetime-local",value:z,onChange:s=>K(s.target.value),min:new Date().toISOString().slice(0,16),className:"w-full rounded border border-blue-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Allotment PDF will be emailed to all selected candidates at the scheduled time"})]}),e.jsx(g,{variant:"primary",size:"sm",onClick:fe,isLoading:ie,disabled:!z,className:"w-full",children:"Schedule Email to Selected Candidates"}),ce?e.jsx("div",{className:"text-xs text-blue-700",children:"Loading email status..."}):E?.summary&&e.jsxs("div",{className:"bg-white rounded border border-blue-200 p-3 space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-blue-900",children:"Overall Status"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-green-600 font-semibold",children:E.summary.totalSent||0}),e.jsx("div",{className:"text-slate-600",children:"Sent"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-amber-600 font-semibold",children:E.summary.totalPending||0}),e.jsx("div",{className:"text-slate-600",children:"Pending"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-red-600 font-semibold",children:E.summary.totalFailed||0}),e.jsx("div",{className:"text-slate-600",children:"Failed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600 font-semibold",children:E.summary.totalNotScheduled||0}),e.jsx("div",{className:"text-slate-600",children:"Not Sent"})]})]})]})]})]}),ne&&f?.file_path&&e.jsx("div",{className:"rounded-lg border bg-slate-50 p-3",children:e.jsx(ke,{src:f.file_path,fileName:f.original_name||f.file_name||"Allotment File",variant:"card"})})]})}),pe()]})},Be=[{value:"ELIGIBLE",label:"Eligible List",color:"blue"},{value:"PROVISIONAL_SELECTED",label:"Provisional List",color:"blue"},{value:"SELECTED",label:"Final List",color:"blue"}],Qe=()=>{const[o]=ve(),[l,p]=a.useState([]),[h,y]=a.useState([]),[u,x]=a.useState(o.get("post_id")||""),[n,N]=a.useState(o.get("district_id")||""),[j,d]=a.useState("ELIGIBLE"),[t,m]=a.useState([]),[k,v]=a.useState(!1);a.useEffect(()=>{B(),A()},[]),a.useEffect(()=>{u&&n?U():m([])},[u,n,j]);const B=async()=>{try{const r=await w.get("/admin/review/posts");r.data.success&&p(Array.isArray(r.data.data)?r.data.data:[])}catch{c.error("Failed to load posts")}},A=async()=>{try{const r=await w.get("/masters/districts");r.data.success&&y(r.data.data||[])}catch{c.error("Failed to load districts")}},U=async()=>{v(!0);try{const r=new URLSearchParams;n&&r.append("district_id",n),r.append("stage",j);const f=await w.get(`/admin/review/posts/${u}/stage-report?${r.toString()}`);f.data.success&&m(f.data.data?.rows||[])}catch(r){c.error(r.response?.data?.message||"Failed to fetch report")}finally{v(!1)}},I=async r=>{if(!u||!n)return c.error("Select post and district first");v(!0);try{const f=new URLSearchParams({district_id:n,stage:j,format:r}),R=await w.get(`/admin/review/posts/${u}/stage-report?${f.toString()}`,{responseType:"blob"}),O=new Blob([R.data],{type:r==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=document.createElement("a");_.href=window.URL.createObjectURL(O),_.download=`post_${u}_${j.toLowerCase()}.${r==="pdf"?"pdf":"xlsx"}`,document.body.appendChild(_),_.click(),document.body.removeChild(_),c.success(`Downloading ${r.toUpperCase()} report`)}catch(f){c.error(f.response?.data?.message||`Failed to download ${r.toUpperCase()} report`)}finally{v(!1)}},b=a.useMemo(()=>[{key:"sr_no",header:"Sr No."},{key:"application_no",header:"Application No."},{key:"applicant_name",header:"Applicant Name"},{key:"gender",header:"Gender"},{key:"district_name",header:"District"},{key:"post_code",header:"Post Code"},{key:"stage_status",header:"Stage"},{key:"entered_at",header:"Entered At"},{key:"entered_by",header:"Entered By"},{key:"current_status",header:"Current Status"}],[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"Final Lists (Post-wise)",subtitle:"Download Eligible / Provisional / Final lists with PDF or Excel export"}),e.jsxs(ee,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Post"}),e.jsxs("select",{value:u,onChange:r=>x(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select Post"}),l.map(r=>e.jsxs("option",{value:r.post_id,children:[r.post_name," (",r.post_code,")"]},r.post_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"District"}),e.jsxs("select",{value:n,onChange:r=>N(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select District"}),e.jsx("option",{value:"ALL",children:"All Districts"}),h.map(r=>e.jsx("option",{value:r.district_id,children:r.district_name},r.district_id))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stage"}),e.jsx("div",{className:"flex gap-2",children:Be.map(r=>e.jsx("button",{onClick:()=>d(r.value),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-colors ${j===r.value?`bg-${r.color}-600 text-white`:"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs(g,{onClick:()=>I("pdf"),variant:"secondary",disabled:k||!u||!n,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"PDF"]}),e.jsxs(g,{onClick:()=>I("xlsx"),variant:"secondary",disabled:k||!u||!n,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Excel"]})]})]}),e.jsx(ee,{children:e.jsx("div",{className:"overflow-x-auto",children:k?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading report..."})]}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No records found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select a post, district, and stage to view the list"})]}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{className:"bg-slate-900 text-white",children:e.jsx("tr",{children:b.map(r=>e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider",children:r.header},r.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:t.map(r=>e.jsx("tr",{className:"hover:bg-slate-50 transition-colors",children:b.map(f=>e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-700",children:r[f.key]??"—"},f.key))},`${r.application_no}-${r.stage_status}`))})]})})})]})},Ke=()=>{const[o,l]=a.useState([]),[p,h]=a.useState(!0),[y,u]=a.useState(""),[x,n]=a.useState(!1),N=a.useCallback(async()=>{h(!0);try{const t=await Ue(),m=t?.rows||t||[];l(Array.isArray(m)?m:[])}catch(t){console.error("Failed to load district wise report",t),c.error(t.message||"Failed to load report")}finally{h(!1)}},[]);a.useEffect(()=>{N()},[N]);const j=a.useMemo(()=>[{key:"district_name",header:"District Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:t=>t??0},{key:"selected_count",header:"Selected",className:"text-center",render:t=>t??0}],[]),d=a.useMemo(()=>{const t=(y||"").trim().toLowerCase();return t?o.filter(m=>String(m.district_name||"").toLowerCase().includes(t)):o},[o,y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"District Wise Report",description:"District list with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await oe("xlsx");L(t,"district_wise_report.xlsx")}catch(t){c.error(t.message||"Failed to download XLSX")}finally{n(!1)}},children:"Excel"}),e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await oe("pdf");L(t,"district_wise_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{n(!1)}},children:"PDF"})]})}),e.jsx(T,{columns:j,data:d,onSearch:u,isLoading:p,rowKey:"district_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},Xe=()=>{const[o,l]=a.useState([]),[p,h]=a.useState(!0),[y,u]=a.useState(""),[x,n]=a.useState(!1),N=a.useCallback(async()=>{h(!0);try{const t=await Oe(),m=t?.rows||t||[];l(Array.isArray(m)?m:[])}catch(t){console.error("Failed to load component wise report",t),c.error(t.message||"Failed to load report")}finally{h(!1)}},[]);a.useEffect(()=>{N()},[N]);const j=a.useMemo(()=>[{key:"component_name",header:"OSC Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:t=>t??0},{key:"selected_count",header:"Selected",className:"text-center",render:t=>t??0}],[]),d=a.useMemo(()=>{const t=(y||"").trim().toLowerCase();return t?o.filter(m=>String(m.component_name||"").toLowerCase().includes(t)):o},[o,y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"OSC Wise Report",description:"List of One Stop Centers with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await re("xlsx");L(t,"component_wise_report.xlsx")}catch(t){c.error(t.message||"Failed to download XLSX")}finally{n(!1)}},children:"Excel"}),e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await re("pdf");L(t,"component_wise_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{n(!1)}},children:"PDF"})]})}),e.jsx(T,{columns:j,data:d,onSearch:u,isLoading:p,rowKey:"component_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},qe=()=>{const[o,l]=a.useState([]),[p,h]=a.useState(!0),[y,u]=a.useState(""),[x,n]=a.useState(!1),N=a.useCallback(async()=>{h(!0);try{const t=await $e(),m=t?.rows||t||[];l(Array.isArray(m)?m:[])}catch(t){console.error("Failed to load hub wise report",t),c.error(t.message||"Failed to load report")}finally{h(!1)}},[]);a.useEffect(()=>{N()},[N]);const j=a.useMemo(()=>[{key:"hub_name",header:"Hub Name",sortable:!0},{key:"application_count",header:"Applications",className:"text-center",render:t=>t??0},{key:"selected_count",header:"Selected",className:"text-center",render:t=>t??0}],[]),d=a.useMemo(()=>{const t=(y||"").trim().toLowerCase();return t?o.filter(m=>String(m.hub_name||"").toLowerCase().includes(t)):o},[o,y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{title:"Hub Wise Report",description:"List of Hubs with total applications and selected count",extraActions:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await le("xlsx");L(t,"hub_wise_report.xlsx")}catch(t){c.error(t.message||"Failed to download XLSX")}finally{n(!1)}},children:"Excel"}),e.jsx(g,{variant:"outline",size:"sm",isLoading:x,leftIcon:e.jsx(S,{className:"h-4 w-4"}),onClick:async()=>{try{n(!0);const t=await le("pdf");L(t,"hub_wise_report.pdf")}catch(t){c.error(t.message||"Failed to download PDF")}finally{n(!1)}},children:"PDF"})]})}),e.jsx(T,{columns:j,data:d,onSearch:u,isLoading:p,rowKey:"hub_id",enableSelection:!1,showRowNumbers:!0,headerClassName:"bg-slate-900 text-white"})]})},nt=()=>e.jsxs(Se,{children:[e.jsx(D,{path:"/",element:e.jsx(Ce,{to:"post-selected",replace:!0})}),e.jsx(D,{path:"post-selected",element:e.jsx(He,{})}),e.jsx(D,{path:"final-list",element:e.jsx(Qe,{})}),e.jsx(D,{path:"post-wise",element:e.jsx(We,{})}),e.jsx(D,{path:"district-wise",element:e.jsx(Ke,{})}),e.jsx(D,{path:"component-wise",element:e.jsx(Xe,{})}),e.jsx(D,{path:"hub-wise",element:e.jsx(qe,{})})]});export{nt as default};
