import{c as ne,b as de,u as xe,r as n,j as e,B,F as oe,C as r,z as O}from"./index-BLGg1PeM.js";import{I as M,M as U}from"./MediaViewer-DuN6iO5n.js";import{D as x}from"./DocumentViewer-DrAuTLPO.js";import{a as me,b as pe,c as he,d as je}from"./admin.service-VmgXE_XQ.js";import{a as H,f as N}from"./date-za-3UH_q.js";import{A as ue}from"./arrow-left-DiDFDe4r.js";import{C as Ne}from"./circle-check-big-BO0quBY1.js";import{C as fe,a as ye}from"./clock-rQqP1kPe.js";import{T as _e}from"./triangle-alert-DyHRPMb-.js";import"./download-BSOa1T2Y.js";const ge=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],q=ne("check",ge),Pe=()=>{const{id:d}=de(),f=xe(),[c,$]=n.useState(null),[G,z]=n.useState(!0),[y,V]=n.useState([]),[h,_]=n.useState([]),[g,Y]=n.useState(!0),[b,v]=n.useState(!1),j={DRAFT:"bg-gray-100 text-gray-700",SUBMITTED:"bg-blue-100 text-blue-700",ELIGIBLE:"bg-green-100 text-green-700",NOT_ELIGIBLE:"bg-red-100 text-red-700",ON_HOLD:"bg-amber-100 text-amber-700",REJECTED:"bg-red-200 text-red-800",SELECTED:"bg-emerald-100 text-emerald-700",WAITLISTED:"bg-purple-100 text-purple-700"},W=async()=>{try{const s=await me(d);$(s)}catch{O.error("Failed to load application details"),f("/applications")}finally{z(!1)}},Z=async()=>{try{const s=await pe(d);V(Array.isArray(s)?s:[])}catch(s){console.error("Failed to load history",s)}},J=async()=>{try{const s=await he(d);_(Array.isArray(s)?s:[])}catch{_([])}};if(n.useEffect(()=>{W(),Z(),J()},[d]),c&&["ELIGIBLE","ON_HOLD"].includes(c.status),G)return e.jsx("div",{className:"p-6 text-center",children:"Loading application details..."});if(!c)return null;const{applicant:i,post:w,district:D,status:k,eligibility:o}=c,l=i?.personal||{},a=i?.address||{},A=i?.education||[],E=i?.experience||[],C=i?.skills||[],p=i?.documents||[],u=s=>p.find(t=>t?.doc_type===s||t?.doc_type_id===s||t?.documentType?.doc_type_code===s||t?.documentType?.doc_code===s||t?.doc_code===s||t?.doc_type_code===s),X=new Set((h||[]).map(s=>s?.doc_type_id).filter(Boolean)),K=new Set(["PHOTO","SIGNATURE","AADHAAR","RESUME","DOMICILE"]),Q=s=>s?.documentType?.doc_code||s?.documentType?.doc_type_code||s?.doc_code||s?.doc_type_code||s?.doc_type||null,S=p.filter(s=>{const t=Q(s);return!(t&&K.has(t)||s?.doc_type_id&&X.has(s.doc_type_id))});Number(c.merit_score);const ee=p.find(s=>s.doc_type==="PHOTO"),se=p.find(s=>s.doc_type==="SIGNATURE"),te=u("AADHAAR"),ae=u("RESUME"),le=u("DOMICILE"),I=l?.photo_path||ee?.file_path||null,P=l?.signature_path||se?.file_path||null,T=l?.aadhaar_path||te?.file_path||null,L=l?.resume_path||ae?.file_path||null,R=l?.domicile_path||le?.file_path||null,ce=l?.categoryMaster?.category_name||l?.category_name||l?.category||"-",ie=async()=>{try{v(!0);const s=await je(d,{include_images:g}),t=new Blob([s.data],{type:"application/pdf"}),F=window.URL.createObjectURL(t),re=c?.application_no||d,m=document.createElement("a");m.href=F,m.download=`application_${re}.pdf`,document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(F)}catch(s){O.error(s?.response?.data?.message||s?.message||"Failed to download PDF")}finally{v(!1)}};return e.jsxs("div",{className:"space-y-6 max-w-7xl mx-auto pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>f(-1),children:e.jsx(ue,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-900",children:["Application #",c.application_no]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-slate-500 mt-1",children:[e.jsx("span",{children:w?.post_name}),e.jsx("span",{children:"•"}),e.jsx("span",{children:D?.district_name}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${j[k]||"bg-gray-100"}`,children:k?.replace(/_/g," ")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-700",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:s=>Y(s.target.checked)}),"Include photo/signature"]}),e.jsx(B,{variant:"outline",onClick:ie,disabled:b,leftIcon:e.jsx(oe,{className:"h-4 w-4"}),children:b?"Downloading...":"Download PDF"})]})]}),o&&e.jsx(r,{title:"Eligibility Status",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex items-start gap-3",children:o.is_eligible?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-6 w-6 text-green-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-green-700",children:"Eligible"}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Post:"})," ",w?.post_name||"N/A"]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Checked on ",H(o.checked_at)||"N/A"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-6 w-6 text-red-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-red-700",children:"Not Eligible"}),c.system_eligibility_reason?e.jsxs("p",{className:"text-sm text-slate-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",c.system_eligibility_reason]}):o.rejection_reasons&&e.jsxs("p",{className:"text-sm text-slate-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",o.rejection_reasons]})]})]})})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx(r,{title:"Personal Details",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[I&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(M,{src:I,alt:"Applicant Photo",className:"w-32 h-32 rounded-lg object-cover",showPreview:!0})}),P&&e.jsx("div",{className:"flex justify-center -mt-2 mb-2",children:e.jsx(M,{src:P,alt:"Applicant Signature",className:"w-40 h-14 rounded-lg object-contain bg-white",showPreview:!0})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Full Name"}),e.jsx("p",{className:"font-medium",children:l.full_name||"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Gender"}),e.jsx("p",{className:"font-medium",children:c.gender||l.gender||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Age"}),e.jsx("p",{className:"font-medium",children:l.age||"-"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Date of Birth"}),e.jsx("p",{className:"font-medium",children:N(c.date_of_birth||l.dob)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Category"}),e.jsx("p",{className:"font-medium",children:ce})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Aadhaar Number"}),e.jsx("p",{className:"font-medium",children:c.aadhaar_number||l.aadhar_no||"-"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase",children:"Aadhaar File"}),T?e.jsx(x,{src:T,fileName:"Aadhaar",variant:"link"}):e.jsx("span",{className:"text-sm text-slate-500",children:"-"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase",children:"Resume"}),L?e.jsx(x,{src:L,fileName:"Resume",variant:"link"}):e.jsx("span",{className:"text-sm text-slate-500",children:"-"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"text-xs text-slate-500 uppercase",children:"Domicile Certificate"}),R?e.jsx(x,{src:R,fileName:"Domicile Certificate",variant:"link"}):e.jsx("span",{className:"text-sm text-slate-500",children:"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Email"}),e.jsx("p",{className:"font-medium",children:i?.email||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Mobile"}),e.jsx("p",{className:"font-medium",children:i?.mobile_no||"-"})]})]})}),e.jsx(r,{title:"Address",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{children:a.address_line||"-"}),a.address_line2&&e.jsx("p",{children:a.address_line2}),e.jsxs("p",{children:[a?.taluka?.taluka_name||"-",a?.district?.district_name?`, ${a.district.district_name}`:""]}),e.jsxs("p",{className:"font-medium",children:["Pin: ",a.pincode||"-"]}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Selected District (Application)"}),e.jsx("p",{className:"font-medium",children:D?.district_name||"-"})]}),a.permanent_address_same===!1&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Permanent Address"}),e.jsx("p",{children:a.permanent_address_line||"-"}),a.permanent_address_line2&&e.jsx("p",{children:a.permanent_address_line2}),e.jsxs("p",{children:[a?.permanentTaluka?.taluka_name||"-",a?.permanentDistrict?.district_name?`, ${a.permanentDistrict.district_name}`:""]}),e.jsxs("p",{className:"font-medium",children:["Pin: ",a.permanent_pincode||"-"]})]})]})})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(r,{title:"Education",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 uppercase bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Education Level"}),e.jsx("th",{className:"px-4 py-2",children:"Degree"}),e.jsx("th",{className:"px-4 py-2",children:"University/Board"}),e.jsx("th",{className:"px-4 py-2",children:"Year"}),e.jsx("th",{className:"px-4 py-2",children:"Percentage"}),e.jsx("th",{className:"px-4 py-2",children:"Certificate"})]})}),e.jsxs("tbody",{children:[A.map((s,t)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"px-4 py-2",children:s.educationLevel?.level_name||s.qualification_level||"-"}),e.jsx("td",{className:"px-4 py-2 font-medium",children:s.degree_name||s.stream_subject||"-"}),e.jsx("td",{className:"px-4 py-2",children:s.university_board||"-"}),e.jsx("td",{className:"px-4 py-2",children:s.passing_year||"-"}),e.jsx("td",{className:"px-4 py-2",children:s.percentage?`${s.percentage}%`:"-"}),e.jsx("td",{className:"px-4 py-2",children:s.certificate_path?e.jsx(x,{src:s.certificate_path,fileName:"Education Certificate",variant:"link"}):e.jsx("span",{className:"text-slate-400",children:"-"})})]},t)),A.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"px-4 py-2 text-center text-slate-500",children:"No education records found"})})]})]})})}),e.jsx(r,{title:"Experience",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 uppercase bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Organization"}),e.jsx("th",{className:"px-4 py-2",children:"Designation"}),e.jsx("th",{className:"px-4 py-2",children:"Duration"}),e.jsx("th",{className:"px-4 py-2",children:"Total Months"}),e.jsx("th",{className:"px-4 py-2",children:"Certificate"})]})}),e.jsxs("tbody",{children:[E.map((s,t)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:s.organization_name}),e.jsx("td",{className:"px-4 py-2",children:s.designation}),e.jsxs("td",{className:"px-4 py-2",children:[N(s.start_date)||"-"," - ",s.is_current?"Present":N(s.end_date)||"-"]}),e.jsxs("td",{className:"px-4 py-2",children:[s.total_months||"-"," months"]}),e.jsx("td",{className:"px-4 py-2",children:s.certificate_path?e.jsx(x,{src:s.certificate_path,fileName:"Experience Certificate",variant:"link"}):e.jsx("span",{className:"text-slate-400",children:"-"})})]},t)),E.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-2 text-center text-slate-500",children:"No experience records found"})})]})]})})}),e.jsx(r,{title:"Skills",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 uppercase bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Skill"}),e.jsx("th",{className:"px-4 py-2",children:"Notes"}),e.jsx("th",{className:"px-4 py-2",children:"Certificate"})]})}),e.jsxs("tbody",{children:[C.map((s,t)=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:s?.skill?.skill_name||s?.skill_name||"-"}),e.jsx("td",{className:"px-4 py-2",children:s?.notes||"-"}),e.jsx("td",{className:"px-4 py-2",children:s?.certificate_path?e.jsx(U,{src:s.certificate_path,fileName:"Skill Certificate",variant:"link"}):e.jsx("span",{className:"text-slate-400",children:"-"})})]},s.applicant_skill_id||t)),C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-4 py-2 text-center text-slate-500",children:"No skills found"})})]})]})})}),e.jsx(r,{title:"Documents",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-800 mb-2",children:"Post Required Documents"}),h.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"text-xs text-slate-500 uppercase bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Document"}),e.jsx("th",{className:"px-4 py-2",children:"Required"}),e.jsx("th",{className:"px-4 py-2",children:"Uploaded"}),e.jsx("th",{className:"px-4 py-2",children:"Action"})]})}),e.jsx("tbody",{children:h.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:s.doc_type_name||s.doc_type_name_mr||s.doc_code||"-"}),e.jsx("td",{className:"px-4 py-2",children:s.required_for_post?e.jsx("span",{className:"inline-flex px-2 py-0.5 rounded text-xs bg-blue-100 text-blue-700",children:"Post"}):e.jsx("span",{className:"inline-flex px-2 py-0.5 rounded text-xs bg-slate-100 text-slate-700",children:"Common"})}),e.jsx("td",{className:"px-4 py-2",children:s.uploaded?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-700",children:[e.jsx(q,{className:"h-3 w-3"})," Yes"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-amber-700",children:[e.jsx(_e,{className:"h-3 w-3"})," No"]})}),e.jsx("td",{className:"px-4 py-2",children:s.uploaded_document?e.jsx(x,{src:s.uploaded_document.file_path,fileName:s.doc_type_name||"Document",variant:"link"}):e.jsx("span",{className:"text-slate-400",children:"-"})})]},s.doc_type_id))})]})}):e.jsx("div",{className:"p-4 text-center text-slate-500 bg-slate-50 rounded border border-dashed",children:"No required documents configured for this post"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-800 mb-2",children:"Extra Documents"}),S.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:S.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-3 hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-xs text-slate-900 line-clamp-2",children:s.documentType?.doc_type_name||s.doc_type}),s.is_verified&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-600 mt-1",children:[e.jsx(q,{className:"h-3 w-3"})," Verified"]})]})}),e.jsx("div",{className:"mt-2",children:e.jsx(U,{src:s.file_path,fileName:s.documentType?.doc_type_name||s.doc_type,variant:"card"})})]},t))}):e.jsx("div",{className:"p-4 text-center text-slate-500 bg-slate-50 rounded border border-dashed",children:"No extra documents uploaded"})]})]})})]})]}),y.length>0&&e.jsx(r,{title:"Status History",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b last:border-0",children:[e.jsx(ye,{className:"h-4 w-4 text-slate-400 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${j[s.old_status]||"bg-gray-100"}`,children:s.old_status||"NEW"}),e.jsx("span",{className:"text-slate-400",children:"→"}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${j[s.new_status]||"bg-gray-100"}`,children:s.new_status})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[s.changed_by_type==="SYSTEM"?"System":s.changedByUser?.full_name||"Admin"," •",H(/Z|[+-]\d\d:?\d\d$/.test(s.created_at||"")?s.created_at:`${s.created_at}Z`)||""]}),s.remarks&&e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:s.remarks})]})]},s.history_id||t))})})})]})};export{Pe as default};
